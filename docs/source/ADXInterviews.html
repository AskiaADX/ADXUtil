<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">var common = require(&#39;../common/common.js&#39;);
var errMsg = common.messages.error;
var uuid   = require(&#39;node-uuid&#39;);
var InteractiveADXShell = require(&#39;../common/InteractiveADXShell.js&#39;).InteractiveADXShell;

<span id='ADX-Interview'>/**
</span> * Manipulate an interview
 *
 * @class ADX.Interview
 */
function Interview(id, adxDirPath) {
<span id='ADX-Interview-property-id'>    /**
</span>     * Id of the interview
     * @type {String}
     */
    this.id     = id;

<span id='ADX-Interview-property-path'>    /**
</span>     * Path of the ADX directory
     * @type {String}
     */
    this.path   = adxDirPath;

<span id='ADX-Interview-property-shell'>    /**
</span>     * Interactive shell that is used to manipulate the interview
     * @type {InteractiveADXShell}
     */
    this.shell  = new InteractiveADXShell(this.path, { mode : &#39;interview&#39; });
}

<span id='ADX-Interview-method-constructor'>/**
</span> * Create a new instance of interview
 *
 * @constructor
 * @param {String} id Id of the interview
 * @param {String} adxDirPath Path of the ADX directory
 */
Interview.prototype.constructor = Interview;

<span id='ADX-Interview-method-execCommand'>/**
</span> * Execute a command to manipulate an interview
 *
 * @param {String|&quot;show&quot;|&quot;update&quot;|&quot;restart&quot;} command Command to execute
 * @param {Object} [options] Options of the command
 * @param {String} [options.fixture] Name of the fixture file to use
 * @param {String} [options.output] Output of ADX to use
 * @param {String} [options.properties] Properties of the ADX
 * @param {String} [options.parameters] Parameters to update the interview
 * @param {String} [options.themes] Themes variables to set
 * @param {Function} [callback] Callback function
 */
Interview.prototype.execCommand = function execCommand(command, options, callback) {
    var args = [];

    args.push(command);

    // Swap arguments
    if (typeof options === &#39;function&#39;) {
        callback = options;
        options = {};
    }

    if (&#39;fixture&#39; in options) {
        args.push(&#39;-fixture:&quot;&#39; + options.fixture + &#39;&quot;&#39;);
    }
    if (&#39;output&#39; in options) {
        args.push(&#39;-output:&quot;&#39; + options.output + &#39;&quot;&#39;);
    }
    if (&#39;properties&#39; in options) {
        args.push(&#39;-properties:&quot;&#39; + options.properties + &#39;&quot;&#39;);
    }
    if (&#39;parameters&#39; in options) {
        args.push(&#39;-parameters:&quot;&#39; + options.parameters + &#39;&quot;&#39;)
    }
    if (&#39;themes&#39; in options) {
        args.push(&#39;-themes:&quot;&#39; + options.themes + &#39;&quot;&#39;);
    }

    this.shell.exec(args, callback);
};

<span id='ADX-Interview-method-destroy'>/**
</span> * Destroy the interview
 */
Interview.prototype.destroy = function destroy() {
    this.shell.destroy();
};

<span id='ADX-InterviewsFactory'>/**
</span> * Factory of the interviews
 *
 *      var ADX = require(&#39;adxutil&#39;).ADX;
 *
 *      var myAdx = new ADX(&#39;path/to/adx/&#39;);
 *      myAdx.load(function (err) {
 *          if (err) {
 *              throw err;
 *          }
 *
 *          // Get the instance of the interviews
 *          var inter = myAdx.interviews.create();
 *
 *          console.log(inter.id);
 *
 *      });
 *
 * @class ADX.InterviewsFactory
 */
function InterviewsFactory(adxDirPath) {
    if (!adxDirPath) {
        throw new Error(errMsg.invalidPathArg);
    }

<span id='ADX-InterviewsFactory-property-path'>    /**
</span>     * Path of the ADX directory
     * @type {String}
     */
    this.path   = adxDirPath;

<span id='ADX-InterviewsFactory-property-_cache'>    /**
</span>     * Interviews cache
     *
     * @type {Object}
     * @private
     */
    this._cache = {};
}

<span id='ADX-InterviewsFactory-method-constructor'>/**
</span> * Create a new instance of interviews factory
*
 * @constructor
 * @param {String} adxDirPath Path of the ADX directory
 */
InterviewsFactory.prototype.constructor = InterviewsFactory;

<span id='ADX-InterviewsFactory-method-create'>/**
</span> * Create a new instance of interview
 *
 * @return {ADX.Interview} Returns a new instance of interview
 */
InterviewsFactory.prototype.create = function createInterview() {
    var id = uuid.v4();
    while (this._cache[id]) {
        id = uuid.v4();
    }
    this._cache[id] = new Interview(id, this.path);
    return this._cache[id];
};

<span id='ADX-InterviewsFactory-method-getById'>/**
</span> * Get the instance of interview using his id
 *
 * @param {String} id Id of the interview to retrieve
 * @return {undefined|ADX.Interview}
 */
InterviewsFactory.prototype.getById = function getById(id) {
    return this._cache[id];
};

<span id='ADX-InterviewsFactory-method-remove'>/**
</span> * Remove the instance of interview using his id
 *
 * @param {String} id Id of the interview to remove
 */
InterviewsFactory.prototype.remove = function remove(id) {
    var interview = this._cache[id];
    if (!interview) {
        return;
    }
    interview.destroy();
    delete this._cache[id];
};

<span id='ADX-InterviewsFactory-method-clear'>/**
</span> * Remove all instance of interviews
 */
InterviewsFactory.prototype.clear = function clear() {
    var id;
    for (id in this._cache) {
        if (this._cache.hasOwnProperty(id)) {
            this.remove(id);
        }
    }
};

// Make it public
exports.InterviewsFactory = InterviewsFactory;</pre>
</body>
</html>

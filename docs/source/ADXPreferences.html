<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">var fs      = require(&#39;fs&#39;);
var path    = require(&#39;path&#39;);
var common  = require(&#39;../common/common.js&#39;);
var msg     = common.messages.message;

<span id='ADX-Preferences'>/**
</span> * Manage the user preferences
 *
 * @class ADX.Preferences
 * @singleton
 */
function Preferences(){}


<span id='ADX-Preferences-method-constructor'>/**
</span> * Create a new instance of ADX Preferences
 *
 * @constructor
 */
Preferences.prototype.constructor = Preferences;

<span id='ADX-Preferences-method-writeError'>/**
</span> * Write an error output in the console
 * @param {String} text Text to write in the console
 */
Preferences.prototype.writeError = function writeError(text) {
    common.writeError.apply(common, arguments);
};

<span id='ADX-Preferences-method-writeWarning'>/**
</span> * Write a warning output in the console
 * @param {String} text Text to write in the console
 */
Preferences.prototype.writeWarning = function writeWarning(text) {
    common.writeWarning.apply(common, arguments);
};

<span id='ADX-Preferences-method-writeSuccess'>/**
</span> * Write a success output in the console
 * @param {String} text Text to write in the console
 */
Preferences.prototype.writeSuccess = function writeSuccess(text) {
    common.writeSuccess.apply(common, arguments);
};

<span id='ADX-Preferences-method-writeMessage'>/**
</span> * Write an arbitrary message in the console without specific prefix
 * @param {String} text Text to write in the console
 */
Preferences.prototype.writeMessage = function writeMessage(text) {
    common.writeMessage.apply(common, arguments);
};

<span id='ADX-Preferences-method-read'>/**
</span> * Read the preferences
 *
 * @param {Object} [options]
 * @param {Boolean} [options.silent=false] By pass the output
 * @param {Function} [callback] Callback
 * @param {Object|null} [callback.preferences]
 * @param {Object} [callback.preferences.author] Default ADX author
 * @param {String} [callback.preferences.author.name] Default Name of the ADX author
 * @param {String} [callback.preferences.author.email] Default Email of the ADX author
 * @param {String} [callback.preferences.author.company] Default Company of the ADX author
 * @param {String} [callback.preferences.author.webSite] Default WebSite of the ADX author
 * @param {Object} [callback.preferences.ZenDesk] Default ZenDesk options
 * @param {String} [callback.preferences.ZenDesk.url] Default ZenDesk URL
 * @param {String} [callback.preferences.ZenDesk.section] Default ZenDesk section
 * @param {String} [callback.preferences.ZenDesk.username] Default ZenDesk username
 * @param {String} [callback.preferences.ZenDesk.password] Default ZenDesk password
 * @param {String} [callback.preferences.ZenDesk.promoted] ZenDesk: create promoted article on article by default
 * @param {String} [callback.preferences.ZenDesk.disabledComments] ZenDesk: disabled article comments by default
 */
Preferences.prototype.read = function read(options, callback) {
    // Swap arguments
    if (typeof options === &#39;function&#39;) {
        callback = options;
        options = null;
    }

    var filePath = path.join(process.env.APPDATA, common.APP_NAME, common.PREFERENCES_FILE_NAME);
    var self = this;
    fs.readFile(filePath, &#39;utf-8&#39;, function (err, data) {
        if (err || !data) {
            if (!options || !options.silent) {
                self.writeMessage(msg.noPreferences);
            }
            if (typeof callback === &#39;function&#39;) {
                callback(null);
            }
            return;
        }

        var json = JSON.parse(data.toString());
        if (!options || !options.silent) {
            self.writeMessage(JSON.stringify(json, null, 2));
        }
        if (typeof callback === &#39;function&#39;) {
            callback(json);
        }
    });
};


<span id='ADX-Preferences-method-write'>/**
</span> * Write the preferences
 *
 * @param {Object} preferences
 * @param {Object} [preferences.author] Default ADX author
 * @param {String} [preferences.author.name] Default Name of the ADX author
 * @param {String} [preferences.author.email] Default Email of the ADX author
 * @param {String} [preferences.author.company] Default Company of the ADX author
 * @param {String} [preferences.author.webSite] Default WebSite of the ADX author
 * @param {Function} [callback] Callback
 * @param {Object|null} [callback.preferences]
 * @param {Object} [callback.preferences.author] Default ADX author
 * @param {String} [callback.preferences.author.name] Default Name of the ADX author
 * @param {String} [callback.preferences.author.email] Default Email of the ADX author
 * @param {String} [callback.preferences.author.company] Default Company of the ADX author
 * @param {String} [callback.preferences.author.website] Default Website of the ADX author
 * @param {Object} [callback.preferences.ZenDesk] Default ZenDesk options
 * @param {String} [callback.preferences.ZenDesk.url] Default ZenDesk URL
 * @param {String} [callback.preferences.ZenDesk.section] Default ZenDesk section
 * @param {String} [callback.preferences.ZenDesk.username] Default ZenDesk username
 * @param {String} [callback.preferences.ZenDesk.password] Default ZenDesk password
 * @param {String} [callback.preferences.ZenDesk.promoted] ZenDesk: create promoted article on article by default
 * @param {String} [callback.preferences.ZenDesk.disabledComments] ZenDesk: disabled article comments by default
 */
Preferences.prototype.write = function write(preferences, callback) {
    if (!preferences || !preferences.author) {
        if (typeof callback === &#39;function&#39;) {
            this.read(callback);
        }
        return;
    }

    var self = this;
    this.read({silent : true}, function (currentPrefs) {
        currentPrefs = currentPrefs || {};
        currentPrefs.author = currentPrefs.author || {};
        if (&quot;name&quot; in preferences.author) {
            currentPrefs.author.name  = preferences.author.name;
        }
        if (&quot;email&quot; in preferences.author) {
            currentPrefs.author.email  = preferences.author.email;
        }
        if (&quot;company&quot; in preferences.author) {
            currentPrefs.author.company  = preferences.author.company;
        }
        if (&quot;website&quot; in preferences.author) {
            currentPrefs.author.website  = preferences.author.website;
        }

        if (preferences.ZenDesk) {
            currentPrefs.ZenDesk = currentPrefs.ZenDesk || {};
            if (&quot;url&quot; in preferences.ZenDesk) {
                currentPrefs.ZenDesk.url = preferences.ZenDesk.url;
            }
            if (&quot;section&quot; in preferences.ZenDesk) {
                currentPrefs.ZenDesk.section = preferences.ZenDesk.section;
            }
            if (&quot;username&quot; in preferences.ZenDesk) {
                currentPrefs.ZenDesk.username = preferences.ZenDesk.username;
            }
            if (&quot;password&quot; in preferences.ZenDesk) {
                currentPrefs.ZenDesk.password = preferences.ZenDesk.password;
            }
            if (&quot;promoted&quot; in preferences.ZenDesk) {
                currentPrefs.ZenDesk.promoted = preferences.ZenDesk.promoted;
            }
            if (&quot;disabledComments&quot; in preferences.ZenDesk) {
                currentPrefs.ZenDesk.disabledComments = preferences.ZenDesk.disabledComments;
            }
        }

        /* DEPRECATED GITHUB PUBLISHER
         if (preferences.github) {
         currentPrefs.github = currentPrefs.github || {};
         if (&quot;username&quot; in preferences.github) {
         currentPrefs.github.username = preferences.github.username;
         }
         if (&quot;remoteUri&quot; in preferences.github) {
         currentPrefs.github.remoteUri = preferences.github.remoteUri;
         }
         if (&quot;useremail&quot; in preferences.github) {
         currentPrefs.github.useremail = preferences.github.useremail;
         }
         if (&quot;message&quot; in preferences.github) {
         currentPrefs.github.message = preferences.github.message;
         }
         if (&quot;token&quot; in preferences.github) {
         currentPrefs.github.token = preferences.github.token;
         }
         }*/

        var filePath = path.join(process.env.APPDATA, common.APP_NAME, common.PREFERENCES_FILE_NAME);
        // Make sure the directory exist
        fs.mkdir(path.join(filePath, &#39;../&#39;), function () {
            fs.writeFile(filePath, JSON.stringify(currentPrefs), {encoding : &#39;utf8&#39;}, function () {
                self.read(callback);
            });
        })
    });
};

<span id='ADX-Preferences-method-getInstance'>/**
</span> * Singleton instance of the preferences
 */
Preferences.getInstance = function getInstance() {
    if (!Preferences._instance) {
        Preferences._instance = new Preferences();
    }
    return Preferences._instance;
};

<span id='ADX-Preferences-property-preferences'>/**
</span> * Single instance of the preferences object
 * @type {ADX.Preferences}
 */
exports.preferences = Preferences.getInstance();

/*
 * Read the user preferences and display it
 *
 * @param {Object} [options]
 * @param {Boolean} [options.silent=false] By pass the output
 * @param {Function} [callback] Callback
 * @param {Object|null} [callback.preferences]
 * @param {Object} [callback.preferences.author] Default ADX author
 * @param {String} [callback.preferences.author.name] Default Name of the ADX author
 * @param {String} [callback.preferences.author.email] Default Email of the ADX author
 * @param {String} [callback.preferences.author.company] Default Company of the ADX author
 * @param {String} [callback.preferences.author.website] Default Website of the ADX author
 * @param {Object} [callback.preferences.zendesk] Default zendesk options
 * @param {String} [callback.preferences.zendesk.username] Default zendesk username
 * @param {String} [callback.preferences.zendesk.remoteUri] Default zendesk uri
 * @param {String} [callback.preferences.zendesk.promoted] Default zendesk promoted
 * @param {String} [callback.preferences.zendesk.comments_disabled] Default zendesk comments_disabled
 */
exports.read = function read(options, callback) {
    exports.preferences.read(options, callback);
};


/*
 * Write the preferences
 *
 * @param {Object} preferences
 * @param {Object} [preferences.author] Default ADX author
 * @param {String} [preferences.author.name] Default Name of the ADX author
 * @param {String} [preferences.author.email] Default Email of the ADX author
 * @param {String} [preferences.author.company] Default Company of the ADX author
 * @param {String} [preferences.author.webSite] Default WebSite of the ADX author
 * @param {Function} [callback] Callback
 * @param {Object|null} [callback.preferences]
 * @param {Object} [callback.preferences.author] Default ADX author
 * @param {String} [callback.preferences.author.name] Default Name of the ADX author
 * @param {String} [callback.preferences.author.email] Default Email of the ADX author
 * @param {String} [callback.preferences.author.company] Default Company of the ADX author
 * @param {String} [callback.preferences.author.webSite] Default WebSite of the ADX author
 * @param {Object} [callback.preferences.ZenDesk] Default ZenDesk options
 * @param {String} [callback.preferences.ZenDesk.url] Default ZenDesk URL
 * @param {String} [callback.preferences.ZenDesk.section] Default ZenDesk section
 * @param {String} [callback.preferences.ZenDesk.username] Default ZenDesk username
 * @param {String} [callback.preferences.ZenDesk.password] Default ZenDesk password
 * @param {String} [callback.preferences.ZenDesk.promoted] ZenDesk: create promoted article on article by default
 * @param {String} [callback.preferences.ZenDesk.disabledComments] ZenDesk: disabled article comments by default
 */
exports.write = function write(preferences, callback) {
    exports.preferences.write(preferences, callback);
};

</pre>
</body>
</html>
